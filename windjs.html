<!doctype html>
<html>
<head>
    <title>Windy-JS (ESRI) Leaflet Demo</title>
    <meta charset="utf-8">
</head>
<body>

    <div id="map"></div>

    <!--leaflet-->
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <script src="leaflet/leaflet.js"></script>
    <script src="resource/L.CanvasOverlay.js"></script>

    <!--other-->
    <link rel="stylesheet" href="resource/demo.css" />
    <script src="resource/windy.js"></script>
    <script src="resource/gfs.js"></script>

    <script>

        console.log('data');
        console.log(data);

        var timer = null;
        var map = L.map('map').setView([50.00, 14.44], 3);
        L.tileLayer(
                "http://{s}.sm.mapstack.stamen.com/" +
                "(toner-lite,$fff[difference],$fff[@23],$fff[hsl-saturation@20])/" +
                "{z}/{x}/{y}.png"
        ).addTo(map);

        //Add CanvasLayer to the map
        canvasOverlay = L.canvasOverlay()
                .drawing(redraw)
                .addTo(map);

        //windy object
        windy = new Windy({canvas: canvasOverlay.canvas(), data: data});

        //prepare context global var
        context = canvasOverlay.canvas().getContext('2d');

        //start drawing wind map
        function redraw(overlay, params) {

            if( timer )
                window.clearTimeout( timer );

            timer = setTimeout(function() { //showing wind is delayed
                var bounds = map.getBounds();
                var size = map.getSize();

                /*context.rect(0,0,3000,3000);
                 context.fillStyle = "red";
                 context.fill();*/

                windy.start( [[0,0],[size.x, size.y]], size.x, size.y,
                        [[bounds._southWest.lng, bounds._southWest.lat ],[bounds._northEast.lng, bounds._northEast.lat]] );
            },750)

        }

        // clear canvas and stop animation
        function clearWind() {
            windy.stop();
            context.clearRect(0, 0, 3000, 3000);
        }

        map.on('dragstart', function() { clearWind() });
        map.on('zoomstart', function() { clearWind() });
        map.on('resize', function() { clearWind() });

    </script>
</body>
</html>
